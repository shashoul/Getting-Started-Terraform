{"title":"CoreDNS","description":"## CoreDNS\n\n Get metrics from CoreDNS in real time to visualize and monitor DNS failures and cache hits/misses.\n\n- [Official Integration Documentation](https://docs.datadoghq.com/integrations/coredns/)\n- [Monitor CoreDNS with Datadog](https://www.datadoghq.com/blog/monitor-coredns-with-datadog/)\n- [Debugging DNS in Kubernetes](https://kubernetes.io/docs/tasks/administer-cluster/dns-debugging-resolution/#check-for-errors-in-the-dns-pod)","widgets":[{"id":0,"layout":{"x":1,"y":10,"width":21,"height":20},"definition":{"type":"note","content":"With this dashboard, you can monitor CoreDNS in real time to visualize and monitor DNS failures and cache hits/misses.\n\n- [CoreDNS Integration Docs](https://docs.datadoghq.com/integrations/coredns/)\n- [Monitor CoreDNS with Datadog](https://www.datadoghq.com/blog/monitor-coredns-with-datadog/)\n- [Debugging DNS in Kubernetes](https://kubernetes.io/docs/tasks/administer-cluster/dns-debugging-resolution/#check-for-errors-in-the-dns-pod)","background_color":"white","font_size":"14","text_align":"left","show_tick":false,"tick_pos":"50%","tick_edge":"left"}},{"id":1,"layout":{"x":23,"y":1,"width":73,"height":7},"definition":{"type":"note","content":"# Cache","background_color":"vivid_blue","font_size":"18","text_align":"center","show_tick":false,"tick_pos":"50%","tick_edge":"left"}},{"id":2,"layout":{"x":97,"y":1,"width":36,"height":7},"definition":{"type":"note","content":"# Resource Usage","background_color":"vivid_blue","font_size":"18","text_align":"center","show_tick":false,"tick_pos":"50%","tick_edge":"left"}},{"id":3,"layout":{"x":23,"y":9,"width":36,"height":17},"definition":{"title":"Cache hits vs misses","title_size":"16","title_align":"left","show_legend":false,"type":"timeseries","requests":[{"q":"avg:coredns.cache_hits_count{$cluster,$deployment,$service,$namespace,$node,$label} by {type}.as_count()","on_right_yaxis":false,"style":{"palette":"dog_classic","line_type":"solid","line_width":"normal"},"display_type":"bars"},{"q":"avg:coredns.cache_misses_count{$cluster,$deployment,$service,$namespace,$node,$label}.as_count()","on_right_yaxis":false,"style":{"palette":"warm","line_type":"solid","line_width":"normal"},"display_type":"bars"}],"yaxis":{"scale":"linear","label":"","include_zero":true,"min":"auto","max":"auto"}}},{"id":4,"layout":{"x":60,"y":9,"width":36,"height":17},"definition":{"title":"Cache size","title_size":"16","title_align":"left","show_legend":false,"legend_size":"0","type":"timeseries","requests":[{"q":"avg:coredns.cache_size.count{$cluster,$deployment,$service,$namespace,$node,$label} by {type}","on_right_yaxis":false,"style":{"palette":"dog_classic","line_type":"solid","line_width":"normal"},"display_type":"bars"}],"yaxis":{"scale":"linear","label":"","include_zero":true,"min":"auto","max":"auto"}}},{"id":5,"layout":{"x":23,"y":27,"width":73,"height":17},"definition":{"title":"Cache hit %","title_size":"16","title_align":"left","show_legend":false,"legend_size":"0","type":"timeseries","requests":[{"q":"avg:coredns.cache_hits_count{$cluster,$deployment,$service,$namespace,$node,$label} by {host}.as_count()*100/(avg:coredns.cache_hits_count{$cluster,$deployment,$service,$namespace,$node,$label} by {host}.as_count()+avg:coredns.cache_misses_count{$cluster,$deployment,$service,$namespace,$node,$label} by {host}.as_count())","on_right_yaxis":false,"style":{"palette":"dog_classic","line_type":"solid","line_width":"normal"},"display_type":"area"}],"yaxis":{"scale":"linear","label":"","include_zero":true,"min":"auto","max":"auto"},"markers":[{"value":"y = 0","display_type":"error dashed"}]}},{"id":6,"layout":{"x":1,"y":32,"width":20,"height":18},"definition":{"type":"note","content":"The higher the hit ratio, the better.\n\nIf this is low, even while overall traffic is high, you should consider raising the TTL value in the CoreDNS cache plugin configuration to keep records cached longer.","background_color":"gray","font_size":"14","text_align":"left","show_tick":true,"tick_pos":"50%","tick_edge":"right"}},{"id":7,"layout":{"x":23,"y":45,"width":73,"height":7},"definition":{"type":"note","content":"# DNS  Latency","background_color":"vivid_blue","font_size":"18","text_align":"center","show_tick":false,"tick_pos":"50%","tick_edge":"left"}},{"id":8,"layout":{"x":23,"y":60,"width":36,"height":17},"definition":{"title":"Average request latency","title_size":"16","title_align":"left","show_legend":false,"legend_size":"0","type":"timeseries","requests":[{"q":"sum:coredns.request_duration.seconds.sum{$cluster,$deployment,$service,$namespace,$node,$label}/sum:coredns.request_duration.seconds.count{$cluster,$deployment,$service,$namespace,$node,$label}","on_right_yaxis":false,"style":{"palette":"dog_classic","line_type":"solid","line_width":"normal"},"display_type":"line"}],"yaxis":{"scale":"linear","label":"","include_zero":true,"min":"auto","max":"auto"}}},{"id":9,"layout":{"x":23,"y":53,"width":73,"height":6},"definition":{"type":"note","content":"## Request","background_color":"blue","font_size":"14","text_align":"center","show_tick":false,"tick_pos":"50%","tick_edge":"left"}},{"id":10,"layout":{"x":23,"y":78,"width":73,"height":6},"definition":{"type":"note","content":"## Response","background_color":"blue","font_size":"14","text_align":"center","show_tick":false,"tick_pos":"50%","tick_edge":"left"}},{"id":11,"layout":{"x":1,"y":61,"width":20,"height":14},"definition":{"type":"note","content":"If CoreDNS is slow to resolve requests, your users could encounter poor performance even if your backend services are all responding quickly.","background_color":"gray","font_size":"14","text_align":"left","show_tick":true,"tick_pos":"50%","tick_edge":"right"}},{"id":12,"layout":{"x":60,"y":60,"width":36,"height":17},"definition":{"title":"Average upstream request latency","title_size":"16","title_align":"left","show_legend":false,"legend_size":"0","type":"timeseries","requests":[{"q":"sum:coredns.forward_request_duration.seconds.sum{$cluster,$deployment,$service,$namespace,$node,$label}/sum:coredns.forward_request_duration.seconds.count{$cluster,$deployment,$service,$namespace,$node,$label}","on_right_yaxis":false,"style":{"palette":"dog_classic","line_type":"solid","line_width":"normal"},"display_type":"line"}],"yaxis":{"scale":"linear","label":"","include_zero":true,"min":"auto","max":"auto"},"custom_links":[]}},{"id":13,"layout":{"x":23,"y":85,"width":36,"height":17},"definition":{"title":"Rcode count","title_size":"16","title_align":"left","show_legend":false,"legend_size":"0","type":"timeseries","requests":[{"q":"avg:coredns.response_code_count{$cluster,$deployment,$service,$namespace,$node,$label} by {rcode}.as_count()","on_right_yaxis":false,"style":{"palette":"dog_classic","line_type":"solid","line_width":"normal"},"display_type":"line"}],"yaxis":{"scale":"linear","label":"","include_zero":true,"min":"auto","max":"auto"},"custom_links":[]}},{"id":14,"layout":{"x":1,"y":78,"width":20,"height":24},"definition":{"type":"note","content":"When CoreDNS encounters an error, it returns an rcode—a standard DNS error code. \n\nErrors like NXDomain and FormErr can reveal a problem with the requests CoreDNS is receiving, while a ServFail error could indicate an issue with the function of the CoreDNS server itself. ","background_color":"gray","font_size":"14","text_align":"left","show_tick":true,"tick_pos":"50%","tick_edge":"right"}},{"id":15,"layout":{"x":60,"y":85,"width":36,"height":17},"definition":{"title":"Rcode count upstream","title_size":"16","title_align":"left","show_legend":false,"legend_size":"0","type":"timeseries","requests":[{"q":"avg:coredns.forward_response_rcode_count{$cluster,$deployment,$service,$namespace,$node,$label} by {rcode}.as_count()","on_right_yaxis":false,"style":{"palette":"dog_classic","line_type":"solid","line_width":"normal"},"display_type":"line"}],"yaxis":{"scale":"linear","label":"","include_zero":true,"min":"auto","max":"auto"},"custom_links":[]}},{"id":16,"layout":{"x":97,"y":9,"width":36,"height":17},"definition":{"title":"CPU Usage","title_size":"16","title_align":"left","show_legend":false,"legend_size":"0","type":"timeseries","requests":[{"q":"max:coredns.process.cpu_seconds_total{$cluster,$deployment,$service,$namespace,$node,$label}.as_count()","on_right_yaxis":false,"style":{"palette":"dog_classic","line_type":"solid","line_width":"normal"},"display_type":"line"}],"yaxis":{"scale":"linear","label":"","include_zero":true,"min":"auto","max":"auto"},"custom_links":[]}},{"id":17,"layout":{"x":97,"y":27,"width":36,"height":17},"definition":{"title":"Open file descriptors","title_size":"16","title_align":"left","show_legend":false,"legend_size":"0","type":"timeseries","requests":[{"q":"avg:coredns.process.max_fds{$cluster,$deployment,$service,$namespace,$node,$label}","on_right_yaxis":false,"style":{"palette":"dog_classic","line_type":"solid","line_width":"normal"},"display_type":"line"},{"q":"avg:coredns.process.open_fds{$cluster,$deployment,$service,$namespace,$node,$label}","on_right_yaxis":false,"style":{"palette":"dog_classic","line_type":"solid","line_width":"normal"},"display_type":"line"}],"yaxis":{"scale":"linear","label":"","include_zero":true,"min":"auto","max":"auto"},"custom_links":[]}},{"id":18,"layout":{"x":135,"y":27,"width":19,"height":17},"definition":{"type":"note","content":" If your graphs show you’re running out of file descriptors, you may need to modify your server configuration to increase the available limit. ","background_color":"gray","font_size":"14","text_align":"left","show_tick":true,"tick_pos":"50%","tick_edge":"left"}},{"id":19,"layout":{"x":97,"y":45,"width":36,"height":6},"definition":{"type":"note","content":"# Memstats","background_color":"blue","font_size":"14","text_align":"center","show_tick":false,"tick_pos":"50%","tick_edge":"bottom"}},{"id":20,"layout":{"x":97,"y":70,"width":36,"height":17},"definition":{"title":"Allocated heap","title_size":"16","title_align":"left","show_legend":false,"legend_size":"0","type":"timeseries","requests":[{"q":"avg:coredns.go.memstats.heap_alloc_bytes{$deployment,$service,$cluster,$namespace,$node,$label}","style":{"palette":"dog_classic","line_type":"solid","line_width":"normal"},"display_type":"line"}],"yaxis":{"scale":"linear","label":"","include_zero":true,"min":"auto","max":"auto"},"custom_links":[]}},{"id":21,"layout":{"x":97,"y":52,"width":36,"height":17},"definition":{"title":"Allocated bytes","title_size":"16","title_align":"left","show_legend":false,"legend_size":"0","type":"timeseries","requests":[{"q":"avg:coredns.go.memstats.alloc_bytes{$deployment,$service,$cluster,$namespace,$node,$label}","style":{"palette":"dog_classic","line_type":"solid","line_width":"normal"},"display_type":"line"}],"yaxis":{"scale":"linear","label":"","include_zero":true,"min":"auto","max":"auto"},"custom_links":[]}},{"id":22,"layout":{"x":1,"y":1,"width":21,"height":8},"definition":{"type":"image","url":"/static/images/logos/coredns_small.svg","sizing":"zoom"}}],"template_variables":[{"name":"cluster","default":"*","prefix":"cluster_name"},{"name":"deployment","default":"*","prefix":"kube_deployment"},{"name":"service","default":"*","prefix":"kube_service"},{"name":"namespace","default":"*","prefix":"kube_namespace"},{"name":"node","default":"*","prefix":"node"},{"name":"label","default":"*","prefix":"label"}],"layout_type":"free","is_read_only":true,"notify_list":[],"id":30389}