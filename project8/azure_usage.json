{"title":"Azure Usage and Quotas","description":"This dashboard provides a high-level overview of your usage against Azure Compute, Storage, and Virtual Network quotas. You can use this dashboard to understand where you are approaching limits that may result in failed provisions, so you can take action to prevent them from occurring. Additional reading on [Azure Usage and Quotas](https://docs.microsoft.com/en-us/azure/azure-subscription-service-limits) and [API Request Limits](https://docs.microsoft.com/en-us/azure/azure-resource-manager/management/request-limits-and-throttling)","widgets":[{"id":0,"layout":{"x":34,"y":25,"width":48,"height":14},"definition":{"title":"Regional vCPUs Quota Consumption, %","title_size":"16","title_align":"left","show_legend":false,"legend_size":"0","type":"timeseries","requests":[{"q":"avg:azure.usage.percentage{usage_category:compute,usage_name:cores,$tenant,$subscription,$region} by {region,subscription_name}","style":{"palette":"dog_classic","line_type":"solid","line_width":"normal"},"display_type":"line"}],"custom_links":[]}},{"id":1,"layout":{"x":83,"y":0,"width":48,"height":24},"definition":{"title":"Highest non-vCPU Based Quota Consumption, %","title_size":"16","title_align":"left","type":"toplist","requests":[{"q":"top(avg:azure.usage.percentage{usage_category:compute,$tenant,$subscription,$region,!usage_name:cores} by {region,usage_name,subscription_name}, 10, 'mean', 'desc')","conditional_formats":[{"comparator":"<","palette":"white_on_green","value":0.5},{"comparator":">","palette":"white_on_red","value":0.9},{"comparator":">=","palette":"white_on_yellow","value":0.5}],"style":{"palette":"dog_classic"}}],"custom_links":[]}},{"id":2,"layout":{"x":34,"y":0,"width":48,"height":24},"definition":{"title":"Highest Regional vCPU Quota Consumption, %","title_size":"16","title_align":"left","type":"toplist","requests":[{"q":"top(avg:azure.usage.percentage{usage_category:compute,usage_name:cores,$tenant,$subscription,$region} by {region,subscription_name}, 10, 'mean', 'desc')","conditional_formats":[{"comparator":"<","palette":"white_on_green","value":0.5},{"comparator":">","palette":"white_on_red","value":0.9},{"comparator":">=","palette":"white_on_yellow","value":0.5}]}]}},{"id":3,"layout":{"x":21,"y":0,"width":12,"height":39},"definition":{"type":"note","content":"Compute Usage","background_color":"gray","font_size":"18","text_align":"center","show_tick":false,"tick_pos":"50%","tick_edge":"bottom"}},{"id":4,"layout":{"x":21,"y":41,"width":12,"height":39},"definition":{"type":"note","content":"Storage Usage","background_color":"gray","font_size":"18","text_align":"center","show_tick":false,"tick_pos":"50%","tick_edge":"bottom"}},{"id":5,"layout":{"x":34,"y":41,"width":48,"height":18},"definition":{"title":"Highest Total Regional Storage Accounts Quota Consumption, %","title_size":"16","title_align":"left","type":"toplist","requests":[{"q":"top(avg:azure.usage.percentage{usage_category:storage,usage_name:storageaccounts,$tenant,$subscription,$region} by {region,subscription_name}, 5, 'mean', 'desc')","conditional_formats":[{"comparator":"<","palette":"white_on_green","value":0.5},{"comparator":">","palette":"white_on_red","value":0.9},{"comparator":">=","palette":"white_on_yellow","value":0.5}],"style":{"palette":"dog_classic"}}],"custom_links":[]}},{"id":6,"layout":{"x":34,"y":60,"width":48,"height":20},"definition":{"title":"Storage Account Quota Consumption %, by Region","title_size":"16","title_align":"left","show_legend":false,"legend_size":"0","type":"timeseries","requests":[{"q":"avg:azure.usage.percentage{usage_category:storage,usage_name:storageaccounts,$tenant,$subscription,$region} by {region,subscription_name}","style":{"palette":"dog_classic","line_type":"solid","line_width":"normal"},"display_type":"line"}],"custom_links":[]}},{"id":7,"layout":{"x":133,"y":0,"width":17,"height":24},"definition":{"type":"note","content":"Virtual machine cores have a regional total limit. There is also a regional limit per-size series, such as Dv2 and F. These limits are enforced separately.\n\nFor additional information see documentation on  [Azure Limits and Quotas](https://docs.microsoft.com/en-us/azure/azure-subscription-service-limits).","background_color":"yellow","font_size":"14","text_align":"left","show_tick":false,"tick_pos":"50%","tick_edge":"left"}},{"id":8,"layout":{"x":133,"y":41,"width":17,"height":34},"definition":{"type":"note","content":"Storage is limited by the number of Storage Accounts per region, per subscription (default is 250 accounts). This is the usage metric that is reported to Datadog from Azure.\n\nEach account is restricted to 2 PiB for US and Europe, and 500 TiB for all other regions. For additional information see documentation on [Azure Storage Limits and Quotas](https://docs.microsoft.com/en-us/azure/azure-subscription-service-limits#storage-limits)","background_color":"yellow","font_size":"14","text_align":"left","show_tick":false,"tick_pos":"50%","tick_edge":"left"}},{"id":9,"layout":{"x":83,"y":25,"width":48,"height":14},"definition":{"title":"Total vCPUs, by Region","title_size":"16","title_align":"left","show_legend":false,"legend_size":"0","type":"timeseries","requests":[{"q":"sum:azure.usage.current_value{$tenant,$subscription,usage_name:cores,$region} by {region,subscription_name}","style":{"palette":"dog_classic","line_type":"solid","line_width":"normal"},"display_type":"area"}],"custom_links":[]}},{"id":10,"layout":{"x":83,"y":41,"width":48,"height":18},"definition":{"title":"Total Storage Accounts, by Region","title_size":"16","title_align":"left","show_legend":false,"legend_size":"0","type":"timeseries","requests":[{"q":"sum:azure.usage.current_value{usage_category:storage,usage_name:storageaccounts,$tenant,$subscription,$region} by {region,subscription_name}","style":{"palette":"dog_classic","line_type":"solid","line_width":"normal"},"display_type":"area"}],"custom_links":[]}},{"id":11,"layout":{"x":83,"y":60,"width":48,"height":20},"definition":{"title":"Total Storage Used, by Region","title_size":"16","title_align":"left","show_legend":false,"legend_size":"0","time":{"live_span":"1w"},"type":"timeseries","requests":[{"q":"sum:azure.storage.used_capacity{$tenant,$subscription,$region} by {region,subscription_name}","style":{"palette":"dog_classic","line_type":"solid","line_width":"normal"},"display_type":"area"}],"custom_links":[]}},{"id":12,"layout":{"x":0,"y":16,"width":20,"height":7},"definition":{"title":"vCPU Cores","title_size":"16","title_align":"left","type":"query_value","requests":[{"q":"sum:azure.usage.current_value{usage_name:cores,$tenant,$subscription,$region}","aggregator":"avg"}],"autoscale":true,"custom_unit":"","precision":0}},{"id":13,"layout":{"x":0,"y":0,"width":20,"height":14},"definition":{"type":"image","url":"/static/images/logos/azure-usage-and-quotas_small.svg","sizing":"fit"}},{"id":14,"layout":{"x":21,"y":123,"width":12,"height":59},"definition":{"type":"note","content":"API Calls Remaining","background_color":"gray","font_size":"18","text_align":"center","show_tick":false,"tick_pos":"50%","tick_edge":"bottom"}},{"id":15,"layout":{"x":34,"y":82,"width":48,"height":18},"definition":{"title":"Highest Regional Network Quota Consumption, %","title_size":"16","title_align":"left","type":"toplist","requests":[{"q":"top(avg:azure.usage.percentage{$tenant,$subscription,$region,usage_category:virtual_network,!usage_name:networkwatchers} by {region,subscription_name,usage_name}, 5, 'mean', 'desc')","conditional_formats":[{"comparator":"<","palette":"white_on_green","value":0.5},{"comparator":">","palette":"white_on_red","value":0.9},{"comparator":">=","palette":"white_on_yellow","value":0.5}],"style":{"palette":"dog_classic"}}],"custom_links":[]}},{"id":16,"layout":{"x":34,"y":101,"width":48,"height":20},"definition":{"title":"Public and Static IP Address Quota Consumption %, by Region","title_size":"16","title_align":"left","show_legend":false,"legend_size":"0","type":"timeseries","requests":[{"q":"avg:azure.usage.percentage{$tenant,$subscription,$region,usage_name:publicipaddresses} by {region,subscription_name}, avg:azure.usage.percentage{$tenant,$subscription,$region,usage_name:staticpublicipaddresses} by {region,subscription_name}","style":{"palette":"dog_classic","line_type":"solid","line_width":"normal"},"display_type":"line"}],"custom_links":[]}},{"id":17,"layout":{"x":83,"y":101,"width":48,"height":20},"definition":{"title":"Network Interfaces by Region","title_size":"16","title_align":"left","show_legend":false,"legend_size":"0","type":"timeseries","requests":[{"q":"avg:azure.usage.current_value{$tenant,$subscription,$region,usage_category:virtual_network,usage_name:networkinterfaces} by {region,subscription_name}","style":{"palette":"dog_classic","line_type":"solid","line_width":"normal"},"display_type":"area"}],"yaxis":{"scale":"linear","label":"","include_zero":true,"min":"auto","max":"auto"},"markers":[]}},{"id":18,"layout":{"x":83,"y":82,"width":48,"height":18},"definition":{"title":"Total Virtual Networks, by Region","title_size":"16","title_align":"left","show_legend":false,"legend_size":"0","type":"timeseries","requests":[{"q":"sum:azure.usage.current_value{$tenant,$subscription,$region,usage_name:virtualnetworks} by {region,subscription_name}","style":{"palette":"dog_classic","line_type":"solid","line_width":"normal"},"display_type":"area"}],"custom_links":[]}},{"id":19,"layout":{"x":132,"y":82,"width":18,"height":21},"definition":{"type":"note","content":"Azure Network resources are limited by a number of regional and per-resource quotas. Many of these limits are high enough that they will not restrict the vast majority of users.\n\n[Learn More](https://docs.microsoft.com/en-us/azure/azure-subscription-service-limits#networking-limits)","background_color":"yellow","font_size":"14","text_align":"left","show_tick":false,"tick_pos":"50%","tick_edge":"left"}},{"id":20,"layout":{"x":21,"y":82,"width":12,"height":39},"definition":{"type":"note","content":"Network Usage","background_color":"gray","font_size":"18","text_align":"center","show_tick":false,"tick_pos":"50%","tick_edge":"bottom"}},{"id":21,"layout":{"x":34,"y":123,"width":48,"height":19},"definition":{"title":"Lowest Remaining API calls (subscription-level)","title_size":"16","title_align":"left","type":"toplist","requests":[{"q":"top(avg:azure.usage.remaining_api_calls{(usage_name:subscription_reads OR usage_name:subscription_resource_requests) AND $subscription AND $tenant} by {subscription_name,usage_name}, 10, 'last', 'asc')"}]}},{"id":22,"layout":{"x":83,"y":123,"width":48,"height":19},"definition":{"title":"Lowest Remaining API Calls (region-level)","title_size":"16","title_align":"left","type":"toplist","requests":[{"q":"top(exclude_null(avg:azure.usage.remaining_api_calls{$subscription,$region,$tenant} by {region,usage_name,subscription_name}), 10, 'last', 'asc')","conditional_formats":[{"comparator":">","palette":"white_on_green","value":120},{"comparator":">=","palette":"white_on_yellow","value":70},{"comparator":"<","palette":"white_on_red","value":70}]}]}},{"id":23,"layout":{"x":83,"y":163,"width":48,"height":19},"definition":{"title":"Remaining High Cost VMSS Views (3min)","title_size":"16","title_align":"left","show_legend":false,"legend_size":"0","type":"timeseries","requests":[{"q":"top(avg:azure.usage.remaining_api_calls{usage_name:compute_highcostgetvmscaleset_3min,$region,$subscription,$tenant} by {usage_name,region,subscription_name}, 50, 'last', 'asc')","style":{"palette":"dog_classic","line_type":"solid","line_width":"normal"},"display_type":"line"}],"yaxis":{"scale":"linear","label":"","include_zero":true,"min":"auto","max":"auto"},"markers":[]}},{"id":24,"layout":{"x":83,"y":143,"width":48,"height":19},"definition":{"title":"Subscription Reads Remaining","show_legend":false,"legend_size":"0","type":"timeseries","requests":[{"q":"avg:azure.usage.remaining_api_calls{$subscription,usage_name:subscription_reads,$tenant} by {subscription_name}","on_right_yaxis":false,"style":{"palette":"dog_classic","line_type":"solid","line_width":"normal"},"display_type":"line"}],"yaxis":{"scale":"linear","label":"","include_zero":true,"min":"auto","max":"auto"},"markers":[]}},{"id":25,"layout":{"x":34,"y":143,"width":48,"height":39},"definition":{"title":"Remaining Calls vs Previous Day Avg","title_size":"16","title_align":"left","type":"change","requests":[{"q":"avg:azure.usage.remaining_api_calls{$region,*,$subscription,$tenant} by {usage_name,subscription_name,region}","compare_to":"day_before","order_by":"change","order_dir":"asc","increase_good":true,"change_type":"relative","show_present":true}]}},{"id":26,"layout":{"x":132,"y":123,"width":18,"height":24},"definition":{"type":"note","content":"Azure has limits on the number of calls that can be made to it's management APIs. When these limits are reached, throttling occurs which can cause errors, timeouts, and other issues that can impact your operations or applications.\n\n[Learn More](https://docs.microsoft.com/en-us/azure/azure-resource-manager/management/request-limits-and-throttling)","background_color":"yellow","font_size":"14","text_align":"left","show_tick":false,"tick_pos":"50%","tick_edge":"left"}},{"id":27,"layout":{"x":0,"y":32,"width":20,"height":7},"definition":{"title":"Virtual Networks","title_size":"16","title_align":"left","type":"query_value","requests":[{"q":"sum:azure.usage.current_value{$tenant,$subscription,$region,usage_name:virtualnetworks}","aggregator":"avg"}],"autoscale":true,"precision":0}},{"id":28,"layout":{"x":0,"y":24,"width":20,"height":7},"definition":{"title":"Storage Accounts","title_size":"16","title_align":"left","type":"query_value","requests":[{"q":"sum:azure.usage.current_value{usage_category:storage,usage_name:storageaccounts,$tenant,$subscription,$region}","aggregator":"avg"}],"precision":0}}],"template_variables":[{"name":"tenant","default":"*","prefix":"tenant_name"},{"name":"subscription","default":"*","prefix":"subscription_name"},{"name":"region","default":"*","prefix":"region"}],"layout_type":"free","is_read_only":true,"notify_list":[],"id":30291}